(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-341781e4","chunk-4fabfa07"],{3007:function(e,t,n){},"498a":function(e,t,n){"use strict";var a=n("23e7"),r=n("58a8").trim,o=n("c8d2");a({target:"String",proto:!0,forced:o("trim")},{trim:function(){return r(this)}})},"91fc":function(e,t,n){"use strict";var a=n("ddec"),r=n.n(a);r.a},b87d:function(e,t,n){"use strict";var a=n("3007"),r=n.n(a);r.a},c8d2:function(e,t,n){var a=n("d039"),r=n("5899"),o="​᠎";e.exports=function(e){return a((function(){return!!r[e]()||o[e]()!=o||r[e].name!==e}))}},ddec:function(e,t,n){},eb83:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"monRoot"}},[n("Modal",{attrs:{width:"600",closable:!1,"mask-closable":!1},model:{value:e.dottingModal,callback:function(t){e.dottingModal=t},expression:"dottingModal"}},[n("Form",{ref:"formInline",attrs:{"label-width":120}},[n("FormItem",{attrs:{label:"请输入名称："}},[n("Input",{staticStyle:{width:"200px"},attrs:{size:"small",maxlength:20},model:{value:e.dottingName,callback:function(t){e.dottingName=t},expression:"dottingName"}}),n("span",{staticStyle:{color:"#fff"}},[e._v(e._s(e.dottingName.length)+"/20")]),n("Button",{staticStyle:{"margin-left":"30px"},attrs:{type:"primary",size:"small"},on:{click:e.dottingConfirm}},[e._v("确定")]),n("Button",{staticStyle:{background:"rgba(13,67,111,1)",color:"rgba(199,219,244,1)","margin-left":"10px"},attrs:{size:"small"},on:{click:e.dottingCancel}},[e._v("取消")])],1)],1),n("p",{attrs:{slot:"footer"},slot:"footer"})],1)],1)},r=[],o=(n("498a"),n("b85c")),i=n("4ec3"),s={data:function(){return{dottingName:"",recodePlanConfirmModal:!1,dottingModal:!1,sumaQtPlayer:"",isStart:1,recodeSwitchFlag:!1,receiveObj:{},recordPlayUrlChange:[],playerType:"",playerbaseIndex:0,playerRecIndex:0,isGray:!1}},created:function(){var e=this;this.isGray=1!=JSON.parse(localStorage.getItem("loginRes")).user.operationPermissions,this.$bus.$on("showPlay",(function(t){e.setQmlPlayerProperty(t)})),this.$bus.$on("recodeSwitchFlag",(function(t){e.recodeSwitchFlag=t})),this.$bus.$on("receiveObj",(function(t){e.receiveObj=t})),this.$bus.$on("dottingModal",(function(t){e.dottingModal=t,e.dottingName=""}))},destroyed:function(){this.$bus.$off("showPlayer"),this.$bus.$off("recodeSwitchFlag"),this.$bus.$off("receiveObj"),this.$bus.$off("dottingModal")},mounted:function(){var e=this;console.log(999,this.$sumaQtPlayer),setTimeout((function(){var t=e;t.$sumaQtPlayer}),0)},methods:{getServerTime:function(){var e=this;i["a"].getServerTime({}).then((function(t){var n=t.result.secondTimeStamp;e.setQmlPlayerServerTime(n)}))},recodeConfirm:function(){var e=this;if(this.recodeSwitchFlag){var t={isStartRecord:0,autoRecordPlan:this.isStart,channelIdList:[this.receiveObj.channelId]},n=JSON.parse(sessionStorage.getItem("monitorState"));i["a"].startOrStopRecord(t).then((function(t){e.$Message.success("录制已启动"),e.$emit("changeRecode"),e.recodePlanConfirmModal=!1;var a=[{groupIndex:-2,playerIndex:-2,channelId:"",business:{},player:{isVisible:!0}}];e.setQmlPlayerProperty(a);var r,i=Object(o["a"])(n);try{for(i.s();!(r=i.n()).done;){var s=r.value;(s.playerIndex===e.receiveObj.playerIndex||s.channelId===e.receiveObj.channelId)&&(s.business.isRecording=!0)}}catch(l){i.e(l)}finally{i.f()}e.setQmlPlayerProperty(n),sessionStorage.setItem("monitorState",JSON.stringify(n))}),(function(t){e.setQmlPlayerProperty(n)}))}else{var a={isStartRecord:1,autoRecordPlan:this.isStart,channelIdList:[this.receiveObj.channelId]},r=JSON.parse(sessionStorage.getItem("monitorState"));i["a"].startOrStopRecord(a).then((function(t){e.$Message.success("录制已关闭"),e.$emit("changeRecode"),e.recodePlanConfirmModal=!1;var n=[{groupIndex:-2,playerIndex:-2,channelId:"",business:{},player:{isVisible:!0}}];e.setQmlPlayerProperty(n);var a,i=Object(o["a"])(r);try{for(i.s();!(a=i.n()).done;){var s=a.value;(s.playerIndex===e.receiveObj.playerIndex||s.channelId===e.receiveObj.channelId)&&(s.business.isRecording=!1)}}catch(l){i.e(l)}finally{i.f()}e.setQmlPlayerProperty(r),sessionStorage.setItem("monitorState",JSON.stringify(r))}),(function(t){e.setQmlPlayerProperty(r),e.recodePlanConfirmModal=!1}))}},recodeCancel:function(){this.recodePlanConfirmModal=!1;var e=JSON.parse(sessionStorage.getItem("monitorState"));this.setQmlPlayerProperty(e);var t=[{groupIndex:-2,playerIndex:-2,channelId:"",business:{},player:{isVisible:!0}}];this.setQmlPlayerProperty(t)},dottingConfirm:function(){var e=this;if(!this.dottingName)return this.$Message.info("请输入打点名称"),!1;if(!this.dottingName.trim())return this.$Message.info("名称不能仅包含空格"),!1;var t,n=JSON.parse(sessionStorage.getItem("monitorState")),a="",r=Object(o["a"])(n);try{for(r.s();!(t=r.n()).done;){var s=t.value;if(s.playerIndex===this.receiveObj.playerIndex){a=s.timestamp;break}}}catch(c){r.e(c)}finally{r.f()}var l={channelId:this.receiveObj.channelId,name:this.dottingName,startDate:this.timestampToTime(a),endDate:this.timestampToTime(this.receiveObj.timestamp),type:"2"};i["a"].createChannelProgram(l).then((function(t){e.$Message.success("导播节目添加成功"),e.$emit("dottedSuccess");var a,r=Object(o["a"])(n);try{for(r.s();!(a=r.n()).done;){var i=a.value;(i.playerIndex===e.receiveObj.playerIndex||i.channelId===e.receiveObj.channelId)&&(i.business.isDotting=!1)}}catch(c){r.e(c)}finally{r.f()}e.setQmlPlayerProperty(n),sessionStorage.setItem("monitorState",JSON.stringify(n)),e.dottingModal=!1}),(function(t){e.setQmlPlayerProperty(n)}))},dottingCancel:function(){var e=JSON.parse(sessionStorage.getItem("monitorState"));this.dottingModal=!1,this.setQmlPlayerProperty(e)},timestampToTime:function(e){var t=new Date(1e3*e),n=t.getFullYear(),a=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,r=t.getDate(),o=t.getHours(),i=t.getMinutes(),s=t.getSeconds();return n+"-"+a+"-"+r+" "+o+":"+i+":"+s},setQmlPlayerServerTime:function(e){var t={serverUnixTimestamp:e};this.$sumaQtPlayer.setServerTime(JSON.stringify(t),(function(e){}))},createQmlPlayer:function(e,t,n,a,r,o,i){var s=this;s.playerType="rec",sessionStorage.setItem("playerType","rec");var l={mode:i,x:e,y:t,width:n,height:a,rows:r,columns:o};this.$sumaQtPlayer.createPlayer(JSON.stringify(l),(function(e){var t=JSON.parse(e);if("OK"===t.status){s.prepareQmlPlayer1();var n=JSON.parse(sessionStorage.getItem("monitorState"));n&&s.setQmlPlayerProperty(n)}}))},prepareQmlPlayer:function(e,t,n,a,r,i,s){var l=this,c=[{x:e,y:t,groupIndex:-1,playerIndex:-1,playerInfo:{channelId:a,channelName:n,channelUrl:r,timeshiftTotalInSec:s}}];this.recordPlayUrlChange=sessionStorage.getItem("initPlay")?JSON.parse(sessionStorage.getItem("initPlay")):[],this.$sumaQtPlayer.preparePlayer(JSON.stringify(c),(function(e){var t=JSON.parse(e);if("OK"===t.status){var c=[{playerIndex:t.data[0].playerIndex,groupIndex:t.data[0].groupIndex,channelId:t.data[0].channelId,business:{isRecording:i,isDotting:!1},player:{}}];if(l.setQmlPlayerProperty(c),sessionStorage.getItem("monitorState")){var d,y=JSON.parse(sessionStorage.getItem("monitorState")),u=!0,p=Object(o["a"])(y);try{for(p.s();!(d=p.n()).done;){var h=d.value;h.playerIndex===c[0].playerIndex&&(u=!1,h.channelId=c[0].channelId,h.business=c[0].business,h.player=c[0].player,sessionStorage.setItem("monitorState",JSON.stringify(y)))}}catch(I){p.e(I)}finally{p.f()}u&&(y.push(c[0]),sessionStorage.setItem("monitorState",JSON.stringify(y)))}else sessionStorage.setItem("monitorState",JSON.stringify(c));var f={x:100,y:100};f.playerIndex=JSON.parse(e).data[0].playerIndex,f.groupIndex=JSON.parse(e).data[0].groupIndex,f.playerInfo={channelId:a,channelName:n,channelUrl:r,timeshiftTotalInSec:s};var g,m=!0,v=Object(o["a"])(l.recordPlayUrlChange);try{for(v.s();!(g=v.n()).done;){var S=g.value;if(S.playerIndex===f.playerIndex){for(var P in f)l.$set(S,P,f[P]);m=!1;break}}}catch(I){v.e(I)}finally{v.f()}m&&l.recordPlayUrlChange.push(f),sessionStorage.setItem("initPlay",JSON.stringify(l.recordPlayUrlChange))}}))},prepareQmlPlayer1:function(){var e=[];if(this.recordPlayUrlChange=sessionStorage.getItem("initPlay")?JSON.parse(sessionStorage.getItem("initPlay")):[],!this.recordPlayUrlChange.length)return!1;var t,n=Object(o["a"])(this.recordPlayUrlChange);try{for(n.s();!(t=n.n()).done;){var a=t.value,r={x:100,y:100};r.playerIndex=a.playerIndex,r.groupIndex=a.groupIndex,r.playerInfo=a.playerInfo,e.push(r)}}catch(i){n.e(i)}finally{n.f()}this.$sumaQtPlayer.preparePlayer(JSON.stringify(e),(function(e){}))},prepareQmlPlayer2:function(e){this.$sumaQtPlayer.preparePlayer(JSON.stringify(e),(function(e){}))},setQmlPlayerProperty:function(e){this.$sumaQtPlayer.setPlayerProperty(JSON.stringify(e),(function(e){}))},adjustQmlPlayer:function(e){this.$sumaQtPlayer.adjustPlayer(JSON.stringify(e),(function(e){}))},replaceVideoWithPlayer1:function(e){var t=this;t.playerType="base",sessionStorage.setItem("playerType","base"),this.$sumaQtPlayer.replaceVideoWithPlayer(JSON.stringify(e),(function(e){}))},destroyQmlPlayer:function(e){this.$sumaQtPlayer.destroyPlayer(JSON.stringify(e),(function(e){}))},setVersionInfo:function(e){this.$sumaQtPlayer.setVersionInfo(JSON.stringify(e),(function(e){}))},getVersion:function(){var e=this,t={};i["a"].getVersion(t).then((function(t){t.result;var n={versionCode:0,versionName:t.result,versionDescription:""};e.setVersionInfo(n)}))}}},l=s,c=(n("b87d"),n("2877")),d=Object(c["a"])(l,a,r,!1,null,null,null);t["default"]=d.exports},f9cb:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{attrs:{id:"suma-player-parent"}},[n("video",{ref:"video",staticClass:"video-js vjs-default-skin vjs-big-play-centered",attrs:{id:e.playerId,controls:"","x5-playsinline":"true",playsinline:"true","webkit-playsinline":""}})])])},r=[],o={data:function(){return{player:null,playerId:"suma-player",initOptions:{autoplay:!0,muted:!1,loop:!1,preload:"auto",aspectRatio:"16:9",fluid:!0,poster:"",notSupportedMessage:"此视频暂无法播放，请稍后再试",controlBar:{children:[{name:"playToggle"},{name:"volumePanel",inline:!1},{name:"currentTimeDisplay"},{name:"progressControl"},{name:"durationDisplay"},{name:"FullscreenToggle"}]},errorDisplay:!0,bigPlayButton:!0,textTrackDisplay:!1},height:0}},methods:{playLiveWithHlsUrl:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null!=this.player&&(console.log("playLiveWithHlsUrl:"+e),this.player.autoplay(t),this.player.src({type:"application/x-mpegURL",src:e}),1==t&&this.player.play())},playVodWithHlsUrl:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null!=this.player&&(console.log("playVodWithHlsUrl:"+e),this.player.autoplay(t),this.player.src({type:"application/x-mpegURL",src:e}),1==t&&this.player.play())},setPlayerPoster:function(e){this.initOptions.poster=e,null!=this.player&&this.player.poster(e)},setupPlayer:function(){var e=this,t=this;console.log("setup_sumaPalyer"+JSON.stringify(this.initOptions)),this.player=this.$video(this.playerId,this.initOptions,(function(){var n=this;this.on("loadstart",(function(){console.log("loadstart")})),this.on("suspend",(function(){console.log("suspend")})),this.on("abort",(function(){console.log("abort")})),this.on("emptied",(function(){console.log("emptied")})),this.on("stalled",(function(){console.log("stalled")})),this.on("loadedmetadata",(function(){console.log("loadedmetadata"),t.$emit("suma-player-loadedmetadata",t)})),this.on("loadeddata",(function(){console.log("loadeddata")})),this.on("canplay",(function(){console.log("canplay")})),this.on("canplaythrough",(function(){console.log("canplaythrough")})),this.on("playing",(function(){console.log("playing")})),this.on("waiting",(function(){console.log("waiting")})),this.on("seeking",(function(){console.log("seeking")})),this.on("seeked",(function(){console.log("seeked")})),this.on("ended",(function(){console.log("ended"),t.$emit("plyerEnd")})),this.on("durationchange",(function(){console.log("durationchange")})),this.on("pause",(function(){console.log("pause")})),this.on("ratechange",(function(){console.log("ratechange")})),this.on("resize",(function(){console.log("resize")})),this.on("loadstart",(function(){console.log("loadstart")})),this.on("loadstart",(function(){console.log("loadstart")})),this.on("loadstart",(function(){console.log("loadstart")})),this.on("ready",(function(){console.log("player_ready"),t.$emit("suma-player-ready",t)})),this.on("play",(function(){console.log("player_play"),t.$emit("suma-player-play",t)})),this.on("volumechange",(function(){})),this.on("error",(function(){var t=n.error();if(2===t.code){var a=n.bufferedEnd()-6;n.load(e.src),n.currentTime(a),n.play()}console.log("sumapalyer_error:"+JSON.stringify(t))}))}))},resetPlayer:function(){if(null!=this.player){console.log("player_reset"),this.player.dispose();var e='<video\n          id="'.concat(this.playerId,'"\n          ref="video"\n          controls\n          class="video-js vjs-default-skin vjs-big-play-centered"\n          x5-playsinline="true"\n          playsinline="true"\n          webkit-playsinline >\n          </video>');document.getElementById("suma-player-parent").innerHTML+=e,this.setupPlayer()}},pause:function(){null!=this.player&&(this.player.pause(),console.log("player",this.player))}},props:{posterUrl:{type:String,default:""}},watch:{posterUrl:function(e,t){console.log("posterUrl_new:"+e+" old:"+t),this.setPlayerPoster(e)}},computed:{},mounted:function(){console.log("player_startMounted");var e=this;document.addEventListener("WeixinJSBridgeReady",(function(){e.player.play()}),!1),this.setupPlayer(),console.log("player_mounted");var t=window.innerWidth;this.height=t/16*9},beforeDestroy:function(){this.player.dispose()}},i=o,s=(n("91fc"),n("2877")),l=Object(s["a"])(i,a,r,!1,null,null,null);t["a"]=l.exports}}]);
//# sourceMappingURL=chunk-341781e4.50d7a4ff.js.map