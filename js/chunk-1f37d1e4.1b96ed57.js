(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1f37d1e4"],{1749:function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{staticStyle:{width:"100%",height:"38px",background:"rgba(13,67,111,1)","box-shadow":"0px 2px 10px 0px rgba(0, 0, 0, 0.05)","font-size":"14px","font-family":"Microsoft YaHei","font-weight":"400",color:"rgba(255,255,255,1)","padding-left":"24px","line-height":"38px"}},[e._v(" 修改角色 ")]),r("Row",[r("Col",[r("Card",{staticStyle:{margin:"10px"},style:{height:e.tabHeight+"px"}},[r("Row",{staticStyle:{"margin-top":"20px"},attrs:{type:"flex",justify:"center"}},[r("Col",[r("Form",{ref:"roleUpdate",attrs:{model:e.roleUpdate,rules:e.roleUpdateRule,"label-position":"right","label-width":100}},[r("FormItem",{attrs:{label:"名称",prop:"roleName"}},[r("Input",{staticStyle:{width:"466px",height:"32px"},attrs:{type:"text",maxlength:20,placeholder:"请输入"},model:{value:e.roleUpdate.roleName,callback:function(t){e.$set(e.roleUpdate,"roleName",t)},expression:"roleUpdate.roleName"}}),r("span",{staticStyle:{color:"rgba(175,188,204,1)","margin-left":"10px"}},[e._v(e._s(e.roleNameLength)+"/20")])],1),r("FormItem",{attrs:{label:"描述",prop:"description"}},[r("Input",{staticStyle:{width:"466px",height:"32px"},attrs:{type:"text",maxlength:50,placeholder:"请输入"},model:{value:e.roleUpdate.description,callback:function(t){e.$set(e.roleUpdate,"description",t)},expression:"roleUpdate.description"}}),r("span",{staticStyle:{color:"rgba(175,188,204,1)","margin-left":"10px"}},[e._v(e._s(e.descriptionLength)+"/50")])],1),r("FormItem",{attrs:{label:"菜单权限"}},[r("div",{staticStyle:{width:"464px",height:"326px",border:"1px solid rgba(87,111,140,1)","border-radius":"2px","margin-top":"10px",overflow:"auto",background:"rgba(22,60,105,1)"},style:{height:e.tabHeight-320+"px"}},[r("el-tree",{ref:"menuPermissionTree",attrs:{id:"roleUpdateTree",data:e.menuPermission,"node-key":"id","default-checked-keys":e.selectedItemPermissionsElement,"show-checkbox":"","default-expand-all":""}})],1)]),r("FormItem",{attrs:{label:"操作权限"}},[r("CheckboxGroup",{staticStyle:{color:"rgba(255,255,255,1)"},on:{"on-change":e.checkAllGroup},model:{value:e.roleUpdate.operationPermissionArray,callback:function(t){e.$set(e.roleUpdate,"operationPermissionArray",t)},expression:"roleUpdate.operationPermissionArray"}},[r("Checkbox",{attrs:{label:"允许查看",disabled:"",id:"enableWatch"}}),r("Checkbox",{attrs:{label:"允许操作",id:"enableOperation"}})],1)],1),r("FormItem",{staticStyle:{"margin-left":"120px"}},[r("Button",{staticStyle:{background:"rgba(13,67,111,1)",color:"rgba(199,219,244,1)"},on:{click:e.cancelUpdateRole}},[e._v("取消")]),r("Button",{staticStyle:{"margin-left":"49px"},attrs:{type:"primary"},on:{click:function(t){return e.confirmUpdateRole("roleUpdate")}}},[e._v("确定")])],1)],1)],1)],1)],1)],1)],1)],1)},n=[],i=(r("a4d3"),r("e01a"),r("c975"),r("b0c0"),r("d3b7"),r("25f0"),r("53ca")),s=r("b85c"),a=r("4ec3"),l={data:function(){var e=this,t=function(t,r,o){return r?r.length>20?(e.roleNameLength=r.length,o(new Error("角色名称过长,请重新输入!"))):(e.roleNameLength=r.length,void o()):(e.roleNameLength=0,o(new Error("角色名称不能为空!")))},r=function(t,r,o){return r?r.length>50?(e.descriptionLength=r.length,o(new Error("角色描述过长,请重新输入!"))):(e.descriptionLength=r.length,void o()):(e.descriptionLength=0,o(new Error("角色描述不能为空!")))};return{roleUpdate:{roleName:"",description:"",operationPermissionArray:["允许查看"]},roleUpdateRule:{roleName:[{required:!0,message:"角色名称不能为空!",trigger:"blur"},{required:!0,validator:t,trigger:"change"}],description:[{required:!0,message:"角色描述不能为空!",trigger:"blur"},{required:!0,validator:r,trigger:"change"}]},menuPermission:[],operationPermissions:0,choosedMenuIds:[],choosedMenuOnlyIds:[],selectedItemPermissions:[],selectedItemPermissionsElement:[],notLeaf:[],roleNameLength:0,descriptionLength:0,base:1,tabHeight:0}},created:function(){this.queryRoleInfo()},mounted:function(){this.autoFix()},methods:{autoFix:function(){var e=this;this.getDom(),window.onresize=function(){e.getDom()}},getDom:function(){var e=window.innerWidth,t=window.innerHeight;this.base=(e-160)/864,this.tabHeight=t-130},queryRoleInfo:function(){var e=JSON.parse(sessionStorage.getItem("roleParam"));this.queryRolePermission(e),this.roleUpdate.roleName=e.name,this.roleNameLength=e.name.length,this.roleUpdate.description=e.description,this.descriptionLength=e.description.length,this.operationPermissions=e.operationPermissions,1===this.operationPermissions?this.roleUpdate.operationPermissionArray=["允许查看","允许操作"]:this.roleUpdate.operationPermissionArray=["允许查看"]},queryRolePermission:function(e){var t=this;if(e){var r={id:e.id,roleId:e.roleId};a["a"].getSelectedItemPermissions(r).then((function(e){e=e.result;var r=[];if(e.length>0)for(var o=0;o<e.length;o++)r.push(parseInt(e[o].id));t.selectedItemPermissions=r,t.getTheWholeTree(e)}))}},getTheWholeTree:function(e){var t=this,r={systemType:"2"};a["a"].searchMenuList(r).then((function(r){r=r.result,t.menuPermission=[];for(var o=0;o<r.length;o++)t.jsonData(r[o]);t.selectedItemPermissionsElement=[];var n,i=Object(s["a"])(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;-1===t.notLeaf.indexOf(a.id)&&t.selectedItemPermissionsElement.push(parseInt(a.id))}}catch(l){i.e(l)}finally{i.f()}t.menuPermission=r}))},jsonData:function(e){if("object"===Object(i["a"])(e)&&e.constructor===Object.prototype.constructor){var t=[];t.push(e)}else t=e;for(var r=0;r<t.length;r++){var o=t[r];0!==o.permissions.length&&this.notLeaf.push(o.id.toString()),o.label=o.name,o.children=o.permissions,o.expand=!0,o.children&&o.children.length>0?this.jsonData(o.children):0===o.parentId&&(o.disabled=!0)}},getUserChoosedMenuInfo:function(){var e=this.$refs.menuPermissionTree.getHalfCheckedNodes(),t=this.$refs.menuPermissionTree.getCheckedNodes();this.choosedMenuIds=[],this.choosedMenuOnlyIds=[];var r,o=Object(s["a"])(e);try{for(o.s();!(r=o.n()).done;){var n=r.value;this.choosedMenuIds.push(n.id.toString()),this.choosedMenuOnlyIds.push(n.permissionId)}}catch(d){o.e(d)}finally{o.f()}var i,a=Object(s["a"])(t);try{for(a.s();!(i=a.n()).done;){var l=i.value;this.choosedMenuIds.push(l.id.toString()),this.choosedMenuOnlyIds.push(l.permissionId)}}catch(d){a.e(d)}finally{a.f()}},checkAllGroup:function(e){2===e.length?this.operationPermissions=1:1===e.length&&(this.operationPermissions=0)},cancelUpdateRole:function(){this.roleNameLength=0,this.descriptionLength=0,this.$router.push({name:"system-manage-role"})},confirmUpdateRole:function(e){var t=this;this.getUserChoosedMenuInfo();var r=JSON.parse(sessionStorage.getItem("roleParam"));this.$refs[e].validate((function(e){if(e){var o={roleId:r.id,roleOnlyId:r.roleId,roleName:t.roleUpdate.roleName,roleDescription:t.roleUpdate.description,operationPermissions:t.operationPermissions,permissionIds:t.choosedMenuIds,permissionOnlyIds:t.choosedMenuOnlyIds,systemType:2};0===t.choosedMenuIds.length||0===t.choosedMenuOnlyIds.length?t.$Message.error("请选择菜单"):a["a"].roleUpdateDrbs(o).then((function(e){t.$Message.success("修改角色成功"),t.operationPermissions=0,t.choosedMenuIds=[],t.choosedMenuOnlyIds=[],t.roleNameLength=0,t.descriptionLength=0,t.$router.push({name:"system-manage-role"})}),(function(e){t.roleNameLength=0,t.descriptionLength=0}))}}))},handleReset:function(e){this.$refs[e].resetFields()}}},d=l,c=(r("e40b"),r("2877")),h=Object(c["a"])(d,o,n,!1,null,null,null);t["default"]=h.exports},5903:function(e,t,r){},e40b:function(e,t,r){"use strict";var o=r("5903"),n=r.n(o);n.a}}]);
//# sourceMappingURL=chunk-1f37d1e4.1b96ed57.js.map