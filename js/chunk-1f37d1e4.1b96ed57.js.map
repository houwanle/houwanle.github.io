{"version":3,"sources":["webpack:///./src/views/system-manage/components/role-update.vue?4cbf","webpack:///src/views/system-manage/components/role-update.vue","webpack:///./src/views/system-manage/components/role-update.vue?c5a5","webpack:///./src/views/system-manage/components/role-update.vue?5030","webpack:///./src/views/system-manage/components/role-update.vue?2197"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticStyle","_v","style","height","tabHeight","attrs","ref","roleUpdate","roleUpdateRule","model","value","callback","$$v","$set","expression","_s","roleNameLength","descriptionLength","menuPermission","selectedItemPermissionsElement","on","checkAllGroup","cancelUpdateRole","$event","confirmUpdateRole","staticRenderFns","data","Error","roleName","description","operationPermissionArray","operationPermissions","choosedMenuIds","choosedMenuOnlyIds","selectedItemPermissions","notLeaf","base","created","queryRoleInfo","mounted","autoFix","methods","getDom","window","onresize","vm","width","queryRolePermission","roleInfo","name","length","id","roleId","api","getTheWholeTree","systemType","jsonData","array","push","jsonTree","jn","permissions","toString","label","children","expand","disabled","getUserChoosedMenuInfo","$router","$refs","validate","roleOnlyId","roleDescription","permissionIds","permissionOnlyIds","handleReset","resetFields","component"],"mappings":"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","file":"js/chunk-1f37d1e4.1b96ed57.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('div',{staticStyle:{\"width\":\"100%\",\"height\":\"38px\",\"background\":\"rgba(13,67,111,1)\",\"box-shadow\":\"0px 2px 10px 0px rgba(0, 0, 0, 0.05)\",\"font-size\":\"14px\",\"font-family\":\"Microsoft YaHei\",\"font-weight\":\"400\",\"color\":\"rgba(255,255,255,1)\",\"padding-left\":\"24px\",\"line-height\":\"38px\"}},[_vm._v(\" 修改角色 \")]),_c('Row',[_c('Col',[_c('Card',{staticStyle:{\"margin\":\"10px\"},style:({ height:_vm.tabHeight + 'px' })},[_c('Row',{staticStyle:{\"margin-top\":\"20px\"},attrs:{\"type\":\"flex\",\"justify\":\"center\"}},[_c('Col',[_c('Form',{ref:\"roleUpdate\",attrs:{\"model\":_vm.roleUpdate,\"rules\":_vm.roleUpdateRule,\"label-position\":\"right\",\"label-width\":100}},[_c('FormItem',{attrs:{\"label\":\"名称\",\"prop\":\"roleName\"}},[_c('Input',{staticStyle:{\"width\":\"466px\",\"height\":\"32px\"},attrs:{\"type\":\"text\",\"maxlength\":20,\"placeholder\":\"请输入\"},model:{value:(_vm.roleUpdate.roleName),callback:function ($$v) {_vm.$set(_vm.roleUpdate, \"roleName\", $$v)},expression:\"roleUpdate.roleName\"}}),_c('span',{staticStyle:{\"color\":\"rgba(175,188,204,1)\",\"margin-left\":\"10px\"}},[_vm._v(_vm._s(_vm.roleNameLength)+\"/20\")])],1),_c('FormItem',{attrs:{\"label\":\"描述\",\"prop\":\"description\"}},[_c('Input',{staticStyle:{\"width\":\"466px\",\"height\":\"32px\"},attrs:{\"type\":\"text\",\"maxlength\":50,\"placeholder\":\"请输入\"},model:{value:(_vm.roleUpdate.description),callback:function ($$v) {_vm.$set(_vm.roleUpdate, \"description\", $$v)},expression:\"roleUpdate.description\"}}),_c('span',{staticStyle:{\"color\":\"rgba(175,188,204,1)\",\"margin-left\":\"10px\"}},[_vm._v(_vm._s(_vm.descriptionLength)+\"/50\")])],1),_c('FormItem',{attrs:{\"label\":\"菜单权限\"}},[_c('div',{staticStyle:{\"width\":\"464px\",\"height\":\"326px\",\"border\":\"1px solid rgba(87,111,140,1)\",\"border-radius\":\"2px\",\"margin-top\":\"10px\",\"overflow\":\"auto\",\"background\":\"rgba(22,60,105,1)\"},style:({height:_vm.tabHeight-320 + 'px'})},[_c('el-tree',{ref:\"menuPermissionTree\",attrs:{\"id\":\"roleUpdateTree\",\"data\":_vm.menuPermission,\"node-key\":\"id\",\"default-checked-keys\":_vm.selectedItemPermissionsElement,\"show-checkbox\":\"\",\"default-expand-all\":\"\"}})],1)]),_c('FormItem',{attrs:{\"label\":\"操作权限\"}},[_c('CheckboxGroup',{staticStyle:{\"color\":\"rgba(255,255,255,1)\"},on:{\"on-change\":_vm.checkAllGroup},model:{value:(_vm.roleUpdate.operationPermissionArray),callback:function ($$v) {_vm.$set(_vm.roleUpdate, \"operationPermissionArray\", $$v)},expression:\"roleUpdate.operationPermissionArray\"}},[_c('Checkbox',{attrs:{\"label\":\"允许查看\",\"disabled\":\"\",\"id\":\"enableWatch\"}}),_c('Checkbox',{attrs:{\"label\":\"允许操作\",\"id\":\"enableOperation\"}})],1)],1),_c('FormItem',{staticStyle:{\"margin-left\":\"120px\"}},[_c('Button',{staticStyle:{\"background\":\"rgba(13,67,111,1)\",\"color\":\"rgba(199,219,244,1)\"},on:{\"click\":_vm.cancelUpdateRole}},[_vm._v(\"取消\")]),_c('Button',{staticStyle:{\"margin-left\":\"49px\"},attrs:{\"type\":\"primary\"},on:{\"click\":function($event){return _vm.confirmUpdateRole('roleUpdate')}}},[_vm._v(\"确定\")])],1)],1)],1)],1)],1)],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div>\r\n    <div\r\n        style=\"width:100%;\r\n            height:38px;\r\n            background:rgba(13,67,111,1);\r\n            box-shadow:0px 2px 10px 0px rgba(0, 0, 0, 0.05);\r\n            font-size:14px;\r\n            font-family:Microsoft YaHei;\r\n            font-weight:400;\r\n            color:rgba(255,255,255,1);\r\n            padding-left:24px;\r\n            line-height:38px;\"\r\n      >\r\n      修改角色\r\n    </div>\r\n    <Row>\r\n      <Col>\r\n        <Card style=\"margin:10px;\" :style=\"{ height:tabHeight + 'px' }\">\r\n          <Row type=\"flex\" justify=\"center\" style=\"margin-top:20px\">\r\n            <!-- <Col span=\"19\" offset=\"2\"> -->\r\n            <Col>\r\n              <Form ref=\"roleUpdate\" :model=\"roleUpdate\" :rules=\"roleUpdateRule\" label-position=\"right\" :label-width=\"100\">\r\n                <FormItem label=\"名称\" prop=\"roleName\">\r\n                  <Input type=\"text\" v-model=\"roleUpdate.roleName\" :maxlength=\"20\" placeholder=\"请输入\" style=\"width:466px;height:32px;\"></Input>\r\n                  <span style=\"color:rgba(175,188,204,1);margin-left:10px;\">{{ roleNameLength }}/20</span>\r\n                </FormItem>\r\n                <FormItem label=\"描述\" prop=\"description\">\r\n                  <Input type=\"text\" v-model=\"roleUpdate.description\" :maxlength=\"50\" placeholder=\"请输入\" style=\"width:466px;height:32px;\"></Input>\r\n                  <span style=\"color:rgba(175,188,204,1);margin-left:10px;\">{{ descriptionLength }}/50</span>\r\n                </FormItem>\r\n                <FormItem label=\"菜单权限\" style=\"\">\r\n                  <div \r\n                    style=\"width:464px;\r\n                          height:326px;\r\n                          border:1px solid rgba(87,111,140,1);\r\n                          border-radius:2px;\r\n                          margin-top:10px;\r\n                          overflow:auto;\r\n                          background:rgba(22,60,105,1);\" \r\n                    :style=\"{height:tabHeight-320 + 'px'}\"\r\n                    >\r\n                    <el-tree\r\n                      id=\"roleUpdateTree\"\r\n                      ref=\"menuPermissionTree\"\r\n                      :data=\"menuPermission\"\r\n                      node-key=\"id\"\r\n                      :default-checked-keys=\"selectedItemPermissionsElement\"\r\n                      show-checkbox\r\n                      default-expand-all>\r\n                    </el-tree>\r\n                  </div> \r\n                </FormItem>\r\n                <FormItem label=\"操作权限\">\r\n                  <CheckboxGroup v-model=\"roleUpdate.operationPermissionArray\" @on-change=\"checkAllGroup\" style=\"color:rgba(255,255,255,1);\">\r\n                    <Checkbox label=\"允许查看\" disabled id=\"enableWatch\"></Checkbox>\r\n                    <Checkbox label=\"允许操作\" id=\"enableOperation\"></Checkbox>\r\n                  </CheckboxGroup>\r\n                </FormItem>\r\n                <FormItem style=\"margin-left:120px;\">\r\n                  <Button @click=\"cancelUpdateRole\" style=\"background:rgba(13,67,111,1);color:rgba(199,219,244,1);\">取消</Button>\r\n                  <Button type=\"primary\" @click=\"confirmUpdateRole('roleUpdate')\" style=\"margin-left:49px;\">确定</Button>\r\n                </FormItem>\r\n              </Form>\r\n            </Col>\r\n          </Row> \r\n        </Card>\r\n      </Col>\r\n    </Row>\r\n  </div>\r\n</template>\r\n<script>\r\nimport api from '@/api/api'\r\n\r\nexport default {\r\n  data () {\r\n    /** 修改角色名称长度校验 */\r\n    const validateRoleNameLength = (rule, value, callback) => {\r\n      if (!value) {\r\n        this.roleNameLength = 0;\r\n        return callback(new Error(\"角色名称不能为空!\"));\r\n      } else if (value.length > 20) {\r\n        this.roleNameLength = value.length;\r\n        return callback(new Error(\"角色名称过长,请重新输入!\"));\r\n      } else {\r\n        this.roleNameLength = value.length;\r\n        callback();\r\n      }\r\n    };\r\n\r\n    /** 修改角色描述长度校验 */\r\n    const validateDescription = (rule, value, callback) => {\r\n      if (!value) {\r\n        this.descriptionLength = 0;\r\n        return callback(new Error(\"角色描述不能为空!\"));\r\n      } else if (value.length > 50) {\r\n        this.descriptionLength = value.length;\r\n        return callback(new Error(\"角色描述过长,请重新输入!\"));\r\n      } else {\r\n        this.descriptionLength = value.length;\r\n        callback();\r\n      }\r\n    };\r\n\r\n    return {\r\n      roleUpdate:{\r\n        roleName:'', // 修改角色 名称\r\n        description:'', // 修改角色 描述\r\n        operationPermissionArray:['允许查看'], // 操作权限数组\r\n      },\r\n      roleUpdateRule:{\r\n        roleName:[\r\n          { required: true, message: '角色名称不能为空!', trigger: 'blur' },\r\n          { required: true, validator: validateRoleNameLength, trigger: \"change\" },\r\n        ],\r\n        description:[\r\n          { required: true, message: '角色描述不能为空!', trigger: 'blur' },\r\n          { required: true, validator: validateDescription, trigger: \"change\" },\r\n        ]\r\n      },\r\n\r\n      menuPermission: [], // 菜单权限树\r\n      operationPermissions: 0, // 操作权限，默认允许查看，0：不允许操作，1：允许操作\r\n      choosedMenuIds:[], // 已勾选的菜单主键id\r\n      choosedMenuOnlyIds:[], // 已勾选的菜单唯一id\r\n      selectedItemPermissions: [],\r\n      selectedItemPermissionsElement:[], // 默认勾选的节点的 key 的数组\r\n      notLeaf:[], // 非叶子节点  数组\r\n      roleNameLength:0, // 角色名称长度\r\n      descriptionLength:0, // 角色描述长度\r\n\r\n      base:1,   // 分辨率自适应 计算后的倍数\r\n      tabHeight:0,  // 分辨率自适应调整：表格的高度\r\n    }\r\n  },\r\n  created(){\r\n    this.queryRoleInfo();\r\n  },\r\n  mounted(){\r\n    this.autoFix();\r\n  },\r\n  methods:{\r\n\r\n    /** 自适应 */\r\n    autoFix(){\r\n      let vm = this;\r\n      this.getDom();\r\n      window.onresize = function(){\r\n        vm.getDom();\r\n      }\r\n    },\r\n\r\n    /** 获取窗口的宽和高 */\r\n    getDom(){\r\n      let width = window.innerWidth;\r\n      let height = window.innerHeight;\r\n      this.base = (width-160)/(1024-160);\r\n      // this.tabHeight = height - 350;  // 表格页面有“过滤搜索条件”card，表格上方有Button，则采用该方式计算。\r\n      // this.tabHeight = height - 325;  // 表格页面有“过滤搜索条件”card，表格上方无Button，则采用该方式计算。\r\n      // this.tabHeight = height - 275;  // 表格页面无 “过滤搜索条件”card,但表格上方有Button，则采用该方式计算。\r\n      this.tabHeight = height - 130;   // 表格页面无 “过滤搜索条件”card,表格上方无Button，则采用该方式计算。\r\n    },\r\n\r\n    queryRoleInfo(){\r\n      let roleInfo = JSON.parse(sessionStorage.getItem('roleParam'));\r\n      // console.log(roleInfo);\r\n      this.queryRolePermission(roleInfo);\r\n\r\n      this.roleUpdate.roleName = roleInfo.name;\r\n      this.roleNameLength = roleInfo.name.length;\r\n      this.roleUpdate.description = roleInfo.description;\r\n      this.descriptionLength = roleInfo.description.length;\r\n      this.operationPermissions = roleInfo.operationPermissions;\r\n      if(this.operationPermissions === 1){\r\n        this.roleUpdate.operationPermissionArray = ['允许查看','允许操作'];\r\n      } else {\r\n        this.roleUpdate.operationPermissionArray = ['允许查看'];\r\n      }\r\n    },\r\n\r\n    /* 获取角色所具有的菜单权限 */\r\n    queryRolePermission(roleInfo){\r\n      if(roleInfo){\r\n        let param = {\r\n          id:roleInfo.id,\r\n          roleId:roleInfo.roleId,\r\n        }\r\n\r\n        api.getSelectedItemPermissions(param).then(\r\n          res => {\r\n            res = res.result;\r\n            let tempId = [];\r\n            // let tempNewId = []\r\n            if (res.length > 0) {\r\n              for (let i = 0; i < res.length; i++) {\r\n                tempId.push(parseInt(res[i].id))\r\n                // tempNewId.push(res[i].permissionId)\r\n              }\r\n            }\r\n\r\n            this.selectedItemPermissions = tempId;\r\n            // this.selectedItemNewPermissions = tempNewId;\r\n            this.getTheWholeTree(res);\r\n          }\r\n        )\r\n      } \r\n    },\r\n\r\n    /** 获取全部菜单树 */\r\n    getTheWholeTree(selectItem){\r\n      let param = {\r\n        systemType:'2'\r\n      }\r\n\r\n      api.searchMenuList(param).then(\r\n        res => {\r\n          res = res.result;\r\n          this.menuPermission = [];\r\n          for (var i = 0; i < res.length; i++) {\r\n            this.jsonData(res[i])\r\n          }\r\n\r\n          /* 获取勾选权限树 element-ui使用 */\r\n          this.selectedItemPermissionsElement = [];\r\n          for (let item of selectItem) {\r\n            if (this.notLeaf.indexOf(item.id) === -1) {\r\n              this.selectedItemPermissionsElement.push(parseInt(item.id))\r\n            }\r\n          }\r\n          this.menuPermission = res;\r\n        }\r\n      )\r\n    },\r\n\r\n    /**对后台返回数据进行处理 在json数据中添加组件能够识别出来的键值 */\r\n    jsonData(jsonTree){ \r\n      if ((typeof jsonTree === 'object') && (jsonTree.constructor === Object.prototype.constructor)) {\r\n        var array = []\r\n        array.push(jsonTree)\r\n      } else {\r\n        array = jsonTree\r\n      }\r\n      \r\n      for(let i = 0; i < array.length; i++){\r\n        let jn = array[i];\r\n        if (jn.permissions.length !== 0) {\r\n          this.notLeaf.push(jn.id.toString())\r\n        }\r\n        jn.label = jn.name // 新增title属性 保证Tree组件识别\r\n        jn.children = jn.permissions // 新增children属性 保证Tree组件识别\r\n        jn.expand = true // 新增expand属性 保证菜单展开\r\n        if (jn.children && jn.children.length > 0) {\r\n          this.jsonData(jn.children)\r\n        } else if (jn.parentId === 0) {\r\n          jn.disabled = true\r\n        }\r\n      } \r\n    }, \r\n\r\n    /** 获取 用户勾选的（全选和半选）菜单信息 */\r\n    getUserChoosedMenuInfo(){\r\n      let halfChoosed = this.$refs.menuPermissionTree.getHalfCheckedNodes(); // 半选\r\n      let fullChoosed = this.$refs.menuPermissionTree.getCheckedNodes(); // 全选\r\n\r\n      this.choosedMenuIds = [];\r\n      this.choosedMenuOnlyIds = [];\r\n\r\n      for(let half of halfChoosed){\r\n        this.choosedMenuIds.push(half.id.toString());\r\n        this.choosedMenuOnlyIds.push(half.permissionId);\r\n      }\r\n      for(let full of fullChoosed){\r\n        this.choosedMenuIds.push(full.id.toString());\r\n        this.choosedMenuOnlyIds.push(full.permissionId);\r\n      }\r\n    },\r\n\r\n    /** 操作权限设置 */\r\n    checkAllGroup(checkData){\r\n      if(checkData.length === 2){\r\n        this.operationPermissions = 1;\r\n      } else if (checkData.length === 1) {\r\n        this.operationPermissions = 0;\r\n      }\r\n    },\r\n\r\n    cancelUpdateRole(){  // 修改角色----取消\r\n      this.roleNameLength = 0;\r\n      this.descriptionLength = 0;\r\n      this.$router.push({\r\n        name:'system-manage-role'\r\n      })\r\n    },\r\n    confirmUpdateRole(name){  // 修改角色----确定\r\n      this.getUserChoosedMenuInfo();\r\n      let roleInfo = JSON.parse(sessionStorage.getItem('roleParam'));\r\n      \r\n      this.$refs[name].validate(valid => {\r\n        if(valid){\r\n          let param = {\r\n            roleId:roleInfo.id,\r\n            roleOnlyId:roleInfo.roleId,\r\n            roleName:this.roleUpdate.roleName,\r\n            roleDescription:this.roleUpdate.description,\r\n            operationPermissions:this.operationPermissions,\r\n            permissionIds:this.choosedMenuIds,\r\n            permissionOnlyIds:this.choosedMenuOnlyIds,\r\n            systemType:2   // 系统类型：1代表BO，2代表数字录播，3代表云直播\r\n          }\r\n          if(this.choosedMenuIds.length === 0 || this.choosedMenuOnlyIds.length === 0) {\r\n            this.$Message.error('请选择菜单');\r\n          } else {\r\n            api.roleUpdateDrbs(param).then(\r\n              res => {\r\n                this.$Message.success('修改角色成功');\r\n                this.operationPermissions = 0;\r\n                this.choosedMenuIds = [];\r\n                this.choosedMenuOnlyIds = [];\r\n                this.roleNameLength = 0;\r\n                this.descriptionLength = 0;\r\n                this.$router.push({\r\n                  name:'system-manage-role'\r\n                })\r\n              },\r\n              err => {\r\n                this.roleNameLength = 0;\r\n                this.descriptionLength = 0;\r\n              }\r\n            )\r\n          }\r\n        }\r\n      })\r\n    },\r\n    \r\n    // 重置表单\r\n    handleReset (name) {\r\n      this.$refs[name].resetFields()\r\n    },\r\n\r\n\r\n  }\r\n}\r\n</script>\r\n<style >\r\n#roleUpdateTree .el-tree-node__content {\r\n  margin-top:10px;\r\n}\r\n#enableOperation .ivu-checkbox-checked .ivu-checkbox-inner {\r\n  border-color:rgba(199,219,244,1);\r\n}\r\n#enableOperation {\r\n  margin-left: 46px;\r\n}\r\n#enableWatch {\r\n  margin-left: 32px;\r\n}\r\n</style>","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./role-update.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./role-update.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./role-update.vue?vue&type=template&id=4da8611d&\"\nimport script from \"./role-update.vue?vue&type=script&lang=js&\"\nexport * from \"./role-update.vue?vue&type=script&lang=js&\"\nimport style0 from \"./role-update.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./role-update.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./role-update.vue?vue&type=style&index=0&lang=css&\""],"sourceRoot":""}